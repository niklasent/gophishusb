var campaigns=[],statuses={Active:{color:"#1abc9c",label:"label-success",icon:"fa-laptop",point:"ct-point-active"},"In progress":{label:"label-primary"},Completed:{label:"label-success"},"USB Mounted":{color:"#f9bf3b",label:"label-warning",icon:"fa-usb",point:"ct-point-mount"},"Opened Macro":{color:"#F39C12",label:"label-macro",icon:"fa-file",point:"ct-point-macro"},"Opened Executable":{color:"#f05b4f",label:"label-danger",icon:"fa-gear",point:"ct-point-exec"},Unknown:{color:"#6c7a89",label:"label-default",icon:"fa-question",point:"ct-point-error"},"Campaign Created":{label:"label-success",icon:"fa-rocket"}},statsMapping={active:"Active",mount:"USB Mounted",macro:"Opened Macro",exec:"Opened Executable"};function deleteCampaign(t){confirm("Delete "+campaigns[t].name+"?")&&api.campaignId.delete(campaigns[t].id).success((function(t){successFlash(t.message),location.reload()}))}function renderPieChart(t){return Highcharts.chart(t.elemId,{chart:{type:"pie",events:{load:function(){var a=this,e=a.renderer,s=a.series[0],n=a.plotLeft+s.center[0],o=a.plotTop+s.center[1];this.innerText=e.text(t.data[0].count,n,o).attr({"text-anchor":"middle","font-size":"16px","font-weight":"bold",fill:t.colors[0],"font-family":"Helvetica,Arial,sans-serif"}).add()},render:function(){this.innerText.attr({text:t.data[0].count})}}},title:{text:t.title},plotOptions:{pie:{innerSize:"80%",dataLabels:{enabled:!1}}},credits:{enabled:!1},tooltip:{formatter:function(){return null!=this.key&&'<span style="color:'+this.color+'">‚óè</span>'+this.point.name+": <b>"+this.y+"%</b><br/>"}},series:[{data:t.data,colors:t.colors}]})}function generateStatsPieCharts(t){var a=[],e={},s=0;$.each(t,(function(t,a){$.each(a.stats,(function(t,a){if("total"==t)return s+=a,!0;e[t]?e[t]+=a:e[t]=a}))})),$.each(e,(function(t,e){if(!(t in statsMapping))return!0;status_label=statsMapping[t],a.push({name:status_label,y:Math.floor(e/s*100),count:e}),a.push({name:"",y:100-Math.floor(e/s*100)});renderPieChart({elemId:t+"_chart",title:status_label,name:t,data:a,colors:[statuses[status_label].color,"#dddddd"]});a=[]}))}function generateTimelineChart(t){var a=[];$.each(t,(function(t,e){var s=moment.utc(e.created_date).local();e.y=0,e.y+=e.stats.macro,e.y+=e.stats.exec,e.y=Math.floor(e.y/e.stats.total*100),a.push({campaign_id:e.id,name:e.name,x:s.valueOf(),y:e.y})})),Highcharts.chart("overview_chart",{chart:{zoomType:"x",type:"areaspline"},title:{text:"USB Phishing Success Overview"},xAxis:{type:"datetime",dateTimeLabelFormats:{second:"%l:%M:%S",minute:"%l:%M",hour:"%l:%M",day:"%b %d, %Y",week:"%b %d, %Y",month:"%b %Y"}},yAxis:{min:0,max:100,title:{text:"% of Success"}},tooltip:{formatter:function(){return Highcharts.dateFormat("%A, %b %d %l:%M:%S %P",new Date(this.x))+"<br>"+this.point.name+"<br>% Success: <b>"+this.y+"%</b>"}},legend:{enabled:!1},plotOptions:{series:{marker:{enabled:!0,symbol:"circle",radius:3},cursor:"pointer",point:{events:{click:function(t){window.location.href="/campaigns/"+this.campaign_id}}}}},credits:{enabled:!1},series:[{data:a,color:"#f05b4f",fillOpacity:.5}]})}$(document).ready((function(){Highcharts.setOptions({global:{useUTC:!1}}),api.campaigns.summary().success((function(t){$("#loading").hide(),(campaigns=t.campaigns).length>0?($("#dashboard").show(),campaignTable=$("#campaignTable").DataTable({columnDefs:[{orderable:!1,targets:"no-sort"},{className:"color-active",targets:[2]},{className:"color-mount",targets:[3]},{className:"color-macro",targets:[4]},{className:"color-exec",targets:[5]}],order:[[1,"desc"]]}),campaignRows=[],$.each(campaigns,(function(t,a){var e=moment(a.created_date).format("MMMM Do YYYY, h:mm:ss a"),s=statuses[a.status].label||"label-default",n="Launch Date: "+moment(a.created_date).format("MMMM Do YYYY, h:mm:ss a")+"<br><br>Number of targets: "+a.stats.active+"<br><br>USBs mounted: "+a.stats.mount+"<br><br>Macros opened: "+a.stats.macro+"<br><br>Executables opened: "+a.stats.exec;campaignRows.push([escapeHtml(a.name),e,a.stats.active,a.stats.mount,a.stats.macro,a.stats.exec,'<span class="label '+s+'" data-toggle="tooltip" data-placement="right" data-html="true" title="'+n+'">'+a.status+"</span>","<div class='pull-right'><a class='btn btn-primary' href='/campaigns/"+a.id+"' data-toggle='tooltip' data-placement='left' title='View Results'>                    <i class='fa fa-bar-chart'></i>                    </a>                    <button class='btn btn-danger' onclick='deleteCampaign("+t+")' data-toggle='tooltip' data-placement='left' title='Delete Campaign'>                    <i class='fa fa-trash-o'></i>                    </button></div>"]),$('[data-toggle="tooltip"]').tooltip()})),campaignTable.rows.add(campaignRows).draw(),generateStatsPieCharts(campaigns),generateTimelineChart(campaigns)):$("#emptyMessage").show()})).error((function(){errorFlash("Error fetching campaigns")}))}));