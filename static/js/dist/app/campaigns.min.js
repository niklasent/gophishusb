var labels={"In progress":"label-primary",Completed:"label-success"},campaigns=[],campaign={};function launch(){Swal.fire({title:"Are you sure?",text:"This will schedule the campaign to be launched.",type:"question",animation:!1,showCancelButton:!0,confirmButtonText:"Launch",confirmButtonColor:"#428bca",reverseButtons:!0,allowOutsideClick:!1,showLoaderOnConfirm:!0,preConfirm:function(){return new Promise((function(a,e){groups=[],$("#targets").select2("data").forEach((function(a){groups.push({name:a.text})})),campaign={name:$("#name").val(),groups:groups},api.campaigns.post(campaign).success((function(e){a(),campaign=e})).error((function(a){$("#modal\\.flashes").empty().append('<div style="text-align:center" class="alert alert-danger">            <i class="fa fa-exclamation-circle"></i> '+a.responseJSON.message+"</div>"),Swal.close()}))}))}}).then((function(a){a.value&&Swal.fire("Campaign Launched!","This campaign has been launched!","success"),$('button:contains("OK")').on("click",(function(){window.location="/campaigns/"+campaign.id.toString()}))}))}function dismiss(){$("#modal\\.flashes").empty(),$("#name").val(""),$("#targets").val("").change()}function deleteCampaign(a){Swal.fire({title:"Are you sure?",text:"This will delete the campaign. This can't be undone!",type:"warning",animation:!1,showCancelButton:!0,confirmButtonText:"Delete "+campaigns[a].name,confirmButtonColor:"#428bca",reverseButtons:!0,allowOutsideClick:!1,preConfirm:function(){return new Promise((function(e,t){api.campaignId.delete(campaigns[a].id).success((function(a){e()})).error((function(a){t(a.responseJSON.message)}))}))}}).then((function(a){a.value&&Swal.fire("Campaign Deleted!","This campaign has been deleted!","success"),$('button:contains("OK")').on("click",(function(){location.reload()}))}))}function setupOptions(){api.groups.summary().success((function(a){if(groups=a.groups,valid_groups=[],groups.forEach((a=>{0!==a.length&&valid_groups.push(a)})),0==valid_groups.length)return modalError("No valid groups found!"),!1;var e=$.map(valid_groups,(function(a){return a.text=a.name,a.title=a.num_targets+" targets",a}));console.log(e),$("#targets.form-control").select2({placeholder:"Select Groups",data:e})}))}function edit(a){setupOptions()}function copy(a){setupOptions(),api.campaignId.get(campaigns[a].id).success((function(a){$("#name").val("Copy of "+a.name)})).error((function(a){$("#modal\\.flashes").empty().append('<div style="text-align:center" class="alert alert-danger">            <i class="fa fa-exclamation-circle"></i> '+a.responseJSON.message+"</div>")}))}$(document).ready((function(){$("#created_date").datetimepicker({widgetPositioning:{vertical:"bottom"},showTodayButton:!0,defaultDate:moment(),format:"MMMM Do YYYY, h:mm a"}),$(".modal").on("hidden.bs.modal",(function(a){$(this).removeClass("fv-modal-stack"),$("body").data("fv_open_modals",$("body").data("fv_open_modals")-1)})),$(".modal").on("shown.bs.modal",(function(a){void 0===$("body").data("fv_open_modals")&&$("body").data("fv_open_modals",0),$(this).hasClass("fv-modal-stack")||($(this).addClass("fv-modal-stack"),$("body").data("fv_open_modals",$("body").data("fv_open_modals")+1),$(this).css("z-index",1040+10*$("body").data("fv_open_modals")),$(".modal-backdrop").not(".fv-modal-stack").css("z-index",1039+10*$("body").data("fv_open_modals")),$(".modal-backdrop").not("fv-modal-stack").addClass("fv-modal-stack"))})),$(document).on("hidden.bs.modal",".modal",(function(){$(".modal:visible").length&&$(document.body).addClass("modal-open")})),$("#modal").on("hidden.bs.modal",(function(a){dismiss()})),api.campaigns.summary().success((function(a){campaigns=a.campaigns,$("#loading").hide(),campaigns.length>0?($("#campaignTable").show(),$("#campaignTableArchive").show(),activeCampaignsTable=$("#campaignTable").DataTable({columnDefs:[{orderable:!1,targets:"no-sort"}],order:[[1,"desc"]]}),archivedCampaignsTable=$("#campaignTableArchive").DataTable({columnDefs:[{orderable:!1,targets:"no-sort"}],order:[[1,"desc"]]}),rows={active:[],archived:[]},$.each(campaigns,(function(a,e){label=labels[e.status]||"label-default";var t="Launch Date: "+moment(e.created_date).format("MMMM Do YYYY, h:mm:ss a")+"<br><br>Number of targets: "+e.stats.total+"<br><br>USBs mounted: "+e.stats.mounted+"<br><br>Macros opened: "+e.stats.macros_opened+"<br><br>Executables opened: "+e.stats.executables_opened,o=[escapeHtml(e.name),moment(e.created_date).format("MMMM Do YYYY, h:mm:ss a"),'<span class="label '+label+'" data-toggle="tooltip" data-placement="right" data-html="true" title="'+t+'">'+e.status+"</span>","<div class='pull-right'><a class='btn btn-primary' href='/campaigns/"+e.id+"' data-toggle='tooltip' data-placement='left' title='View Results'>                    <i class='fa fa-bar-chart'></i>                    </a>            <span data-toggle='modal' data-backdrop='static' data-target='#modal'><button class='btn btn-primary' data-toggle='tooltip' data-placement='left' title='Copy Campaign' onclick='copy("+a+")'>                    <i class='fa fa-copy'></i>                    </button></span>                    <button class='btn btn-danger' onclick='deleteCampaign("+a+")' data-toggle='tooltip' data-placement='left' title='Delete Campaign'>                    <i class='fa fa-trash-o'></i>                    </button></div>"];"Completed"==e.status?rows.archived.push(o):rows.active.push(o)})),activeCampaignsTable.rows.add(rows.active).draw(),archivedCampaignsTable.rows.add(rows.archived).draw(),$('[data-toggle="tooltip"]').tooltip()):$("#emptyMessage").show()})).error((function(){$("#loading").hide(),errorFlash("Error fetching campaigns")})),$.fn.select2.defaults.set("width","100%"),$.fn.select2.defaults.set("dropdownParent",$("#modal_body")),$.fn.select2.defaults.set("theme","bootstrap"),$.fn.select2.defaults.set("sorter",(function(a){return a.sort((function(a,e){return a.text.toLowerCase()>e.text.toLowerCase()?1:a.text.toLowerCase()<e.text.toLowerCase()?-1:0}))}))}));